steps:

  - task: Docker@2
    displayName: Build Image
    inputs:
      containerRegistry: 'dockerHub'
      repository: $(repository)
      command: 'buildAndPush'
      Dockerfile: $(dockerfile)
      buildContext: $(context)

  - task: Docker@2
    displayName: Push Dev Tag
    inputs:
      containerRegistry: 'dockerHub'
      repository: $(repository)
      command: 'Push'
      tags: dev

  - task: Docker@2
    displayName: Push Latest Tag
    condition: startsWith(variables['build.sourceBranch'], 'refs/tags')
    inputs:
      containerRegistry: 'dockerHub'
      repository: $(repository)
      command: 'Push'
      tags: latest

  - task: Docker@2
    displayName: Push Release Tag
    condition: startsWith(variables['build.sourceBranch'], 'refs/tags')
    inputs:
      containerRegistry: 'dockerHub'
      repository: $(repository)
      command: 'Push'
      tags: $(Build.SourceBranchName)
